name: Mutation Testing CI

on: [push, pull_request]

jobs:
  mutation-test:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¦ Checkout repository
      uses: actions/checkout@v3

    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    - name: âœ… Add BugsInPy CLI to PATH
      run: echo "$GITHUB_WORKSPACE/BugsInPy/framework/bin" >> $GITHUB_PATH

    - name: ğŸ Confirm Python version
      run: |
        python --version
        which python

    - name: ğŸ“¥ Install dependencies
      run: |
        pip install -r mutmut/requirements.txt || true
        pip install -e mutmut || true
        pip install python_toolbox
        pip install requests
        pip install PyYAML
        

    - name: ğŸ§ª Run diff-based mutation testing on keras bug
      run: |
        python run_bug_test.py

    - name: ğŸ“¤ Upload mutation results
      uses: actions/upload-artifact@v4
      with:
        name: mutation-results
        path: /tmp/bug-project/**/mutants/survived_mutants.json

    - name: ğŸ¤– Run Ollama mutant explainer
      run: |
        python generate_report.py
